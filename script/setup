#!/bin/bash

set -e

if [[ -n $CODESPACES ]]
then
  dotfiles_dir="/workspaces/.codespaces/.persistedshare/dotfiles"

  # Symlink yadm configuration
  ln -s "${dotfiles_dir}/.config/yadm" "${HOME}/.config/"

  # Bootstrap!
  eval "${dotfiles_dir}/.yadm-project/bin/yadm bootstrap"
else
  # Temporarily clone yadm
  git clone https://github.com/TheLocehiliosan/yadm.git /tmp/yadm-project

  eval "/tmp/yadm-project/yadm clone --bootstrap https://github.com/tarebyte/dotfiles.git"

  # Cleanup
  rm -rf /tmp/yadm-project
fi
